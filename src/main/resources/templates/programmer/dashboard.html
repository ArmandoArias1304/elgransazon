<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Programador - ElGranSazon</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;500;600;700" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#38e07b",
              "primary-dark": "#2bc866",
              "background-light": "#f8faf9",
              "background-dark": "#0f1713",
            },
            fontFamily: {
              display: ["Work Sans"],
            },
            borderRadius: {
              DEFAULT: "0.5rem",
              lg: "0.75rem",
              xl: "1rem",
              "2xl": "1.5rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
    <style>
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        
        .stat-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(56, 224, 123, 0.1), 0 10px 10px -5px rgba(56, 224, 123, 0.04);
        }
        
        .license-key {
            font-family: 'Courier New', monospace;
            background: rgba(56, 224, 123, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(56, 224, 123, 0.3);
        }
        
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        
        /* Bootstrap Modal Support */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1055;
            display: none;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            overflow-y: auto;
            outline: 0;
        }
        
        .modal.fade .modal-dialog {
            transition: transform 0.3s ease-out;
            transform: translate(0, -50px);
        }
        
        .modal.show {
            display: block;
        }
        
        .modal.show .modal-dialog {
            transform: none;
        }
        
        .modal-dialog {
            position: relative;
            width: auto;
            margin: 0.5rem;
            pointer-events: none;
        }
        
        .modal-dialog-centered {
            display: flex;
            align-items: center;
            min-height: calc(100% - 1rem);
        }
        
        .modal-dialog-scrollable {
            height: calc(100% - 1rem);
        }
        
        .modal-dialog-scrollable .modal-content {
            max-height: 100%;
            overflow: hidden;
        }
        
        .modal-content {
            position: relative;
            display: flex;
            flex-direction: column;
            width: 100%;
            pointer-events: auto;
            background-clip: padding-box;
            outline: 0;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1050;
            width: 100vw;
            height: 100vh;
            background-color: #000;
        }
        
        .modal-backdrop.fade {
            opacity: 0;
        }
        
        .modal-backdrop.show {
            opacity: 0.5;
        }
        
        @media (min-width: 576px) {
            .modal-dialog {
                max-width: 500px;
                margin: 1.75rem auto;
            }
            
            .modal-dialog-centered {
                min-height: calc(100% - 3.5rem);
            }
            
            .modal-dialog-scrollable {
                height: calc(100% - 3.5rem);
            }
        }
        
        @media (min-width: 992px) {
            .modal-lg {
                max-width: 800px;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-background-light to-gray-50 dark:from-background-dark dark:to-gray-900 font-display text-gray-800 dark:text-gray-200">

<div class="min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-primary to-primary-dark text-white shadow-lg sticky top-0 z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                        <span class="material-symbols-outlined text-3xl">code</span>
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold">Panel del Programador</h1>
                        <p class="text-white/80 text-sm">Sistema de Gesti칩n ElGranSazon</p>
                    </div>
                </div>
                <a href="/logout" class="inline-flex items-center gap-2 px-4 py-2 bg-white/20 hover:bg-white/30 rounded-xl transition-all backdrop-blur-sm">
                    <span class="material-symbols-outlined">logout</span>
                    <span class="font-semibold">Salir</span>
                </a>
            </div>
        </div>
    </header>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Alert Messages -->
    <div th:if="${successMessage}" class="mb-6 bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500 text-green-800 dark:text-green-300 px-6 py-4 rounded-xl shadow-sm animate-slide-in">
        <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-green-500 text-2xl flex-shrink-0">check_circle</span>
            <span class="text-sm sm:text-base" th:text="${successMessage}"></span>
        </div>
    </div>
    <div th:if="${warningMessage}" class="mb-6 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 text-yellow-800 dark:text-yellow-300 px-6 py-4 rounded-xl shadow-sm animate-slide-in">
        <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-yellow-500 text-2xl flex-shrink-0">warning</span>
            <span class="text-sm sm:text-base" th:text="${warningMessage}"></span>
        </div>
    </div>
    <div th:if="${errorMessage}" class="mb-6 bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 text-red-800 dark:text-red-300 px-6 py-4 rounded-xl shadow-sm animate-slide-in">
        <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-red-500 text-2xl flex-shrink-0">error</span>
            <span class="text-sm sm:text-base" th:text="${errorMessage}"></span>
        </div>
    </div>

    <!-- No License Warning -->
    <div th:if="${noLicense}" class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border-2 border-red-500 overflow-hidden animate-slide-in">
        <div class="bg-gradient-to-r from-red-500 to-red-600 px-6 py-4">
            <div class="flex items-center gap-3 text-white">
                <span class="material-symbols-outlined text-3xl">error</span>
                <h4 class="text-xl font-bold">No hay licencia en el sistema</h4>
            </div>
        </div>
        <div class="p-6">
            <p class="text-lg text-gray-700 dark:text-gray-300 mb-4">No se encontr칩 ninguna licencia configurada. Por favor, crea una licencia para este sistema.</p>
            <button class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary to-primary-dark text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-primary/30 transition-all" data-bs-toggle="modal" data-bs-target="#createLicenseModal">
                <span class="material-symbols-outlined">add_circle</span>
                <span>Crear Licencia Inicial</span>
            </button>
        </div>
    </div>

    <div th:unless="${noLicense}">
        <!-- License Information -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden mb-6 animate-slide-in">
            <div class="bg-gradient-to-r from-primary to-primary-dark px-6 py-4">
                <div class="flex items-center gap-3 text-white">
                    <span class="material-symbols-outlined text-2xl">workspace_premium</span>
                    <h5 class="text-xl font-bold">Informaci칩n de la Licencia</h5>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                    <div class="md:col-span-2">
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Clave de Licencia</p>
                        <div class="license-key text-base font-semibold text-gray-900 dark:text-white" th:text="${license.licenseKey}"></div>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Estado</p>
                        <span th:classappend="${license.status.name() == 'ACTIVE'} ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' : (${license.status.name() == 'SUSPENDED'} ? 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400' : 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400')"
                              class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold">
                            <span th:text="${license.statusDisplayName}"></span>
                        </span>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Paquete</p>
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-primary/10 text-primary" th:text="${license.packageDisplayName}"></span>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Modalidad</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.billingCycleDisplayName}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">L칤mite de Usuarios</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.maxUsersDisplay}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Fecha de Compra</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${#temporals.format(license.purchaseDate, 'dd/MM/yyyy')}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Fecha de Expiraci칩n</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${#temporals.format(license.expirationDate, 'dd/MM/yyyy')}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">D칤as Restantes</p>
                        <span th:classappend="${daysLeft < 0} ? 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400' : (${daysLeft <= 5} ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400' : 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400')"
                              class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold">
                            <span th:text="${daysLeft < 0} ? 'Expirada' : ${daysLeft} + ' d칤as'"></span>
                        </span>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">D칤as Activa</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${daysActive} + ' d칤as'"></p>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex flex-wrap gap-3">
                    <button class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-green-500/30 transition-all" data-bs-toggle="modal" data-bs-target="#renewModal">
                        <span class="material-symbols-outlined text-lg">autorenew</span>
                        <span>Renovar</span>
                    </button>
                    <button class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-purple-500/30 transition-all" data-bs-toggle="modal" data-bs-target="#editLicenseModal">
                        <span class="material-symbols-outlined text-lg">edit</span>
                        <span>Editar Info</span>
                    </button>
                    <button class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-blue-500/30 transition-all" data-bs-toggle="modal" data-bs-target="#changePackageModal">
                        <span class="material-symbols-outlined text-lg">package_2</span>
                        <span>Cambiar Paquete</span>
                    </button>
                    <button th:if="${license.status.name() == 'ACTIVE'}" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-orange-500/30 transition-all" data-bs-toggle="modal" data-bs-target="#suspendModal">
                        <span class="material-symbols-outlined text-lg">pause_circle</span>
                        <span>Suspender</span>
                    </button>
                    <form th:if="${license.status.name() == 'SUSPENDED'}" th:action="@{/programmer/reactivate}" method="post" class="inline">
                        <button type="submit" class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-green-500/30 transition-all">
                            <span class="material-symbols-outlined text-lg">play_circle</span>
                            <span>Reactivar</span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Client Information -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden mb-6 animate-slide-in">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
                <div class="flex items-center gap-3 text-white">
                    <span class="material-symbols-outlined text-2xl">store</span>
                    <h5 class="text-xl font-bold">Informaci칩n del Cliente</h5>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Nombre del Restaurante</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.restaurantName ?: 'No especificado'}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Propietario</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.ownerName ?: 'No especificado'}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">RFC</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.ownerRfc ?: 'No especificado'}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Email</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.ownerEmail ?: 'No especificado'}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">Tel칠fono</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.ownerPhone ?: 'No especificado'}"></p>
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-2">L칤mites del Sistema</p>
                        <p class="text-base font-medium text-gray-900 dark:text-white" th:text="${license.maxUsersDisplay} + ' usuarios, ' + ${license.maxBranches} + ' sucursal(es)'"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Statistics -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6">
            <!-- Empleados -->
            <div class="stat-card bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800">
                <div class="flex items-start justify-between mb-4">
                    <div class="w-12 h-12 bg-blue-500/10 rounded-xl flex items-center justify-center">
                        <span class="material-symbols-outlined text-2xl text-blue-500">group</span>
                    </div>
                </div>
                <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-1">Empleados</p>
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white" th:text="${totalEmployees}">0</h2>
            </div>

            <!-- Productos en Men칰 -->
            <div class="stat-card bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800">
                <div class="flex items-start justify-between mb-4">
                    <div class="w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center">
                        <span class="material-symbols-outlined text-2xl text-primary">restaurant_menu</span>
                    </div>
                </div>
                <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-1">Productos en Men칰</p>
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white" th:text="${totalMenuItems}">0</h2>
            </div>

            <!-- Pedidos Totales -->
            <div class="stat-card bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800">
                <div class="flex items-start justify-between mb-4">
                    <div class="w-12 h-12 bg-yellow-500/10 rounded-xl flex items-center justify-center">
                        <span class="material-symbols-outlined text-2xl text-yellow-500">receipt_long</span>
                    </div>
                </div>
                <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-1">Pedidos Totales</p>
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white" th:text="${totalOrders}">0</h2>
            </div>

            <!-- Clientes -->
            <div class="stat-card bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-gray-800 p-6 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800">
                <div class="flex items-start justify-between mb-4">
                    <div class="w-12 h-12 bg-purple-500/10 rounded-xl flex items-center justify-center">
                        <span class="material-symbols-outlined text-2xl text-purple-500">person</span>
                    </div>
                </div>
                <p class="text-sm font-semibold text-gray-600 dark:text-gray-400 mb-1">Clientes</p>
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white" th:text="${totalCustomers}">0</h2>
            </div>
        </div>

        <!-- Financial Summary -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden mb-6 animate-slide-in">
            <div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4">
                <div class="flex items-center gap-3 text-white">
                    <span class="material-symbols-outlined text-2xl">payments</span>
                    <h5 class="text-xl font-bold">Resumen Financiero</h5>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-6 p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border border-green-200 dark:border-green-800">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-3xl text-green-600 dark:text-green-400">account_balance_wallet</span>
                        <div>
                            <p class="text-sm text-gray-600 dark:text-gray-400 font-semibold mb-1">Total Generado</p>
                            <h3 class="text-3xl font-bold text-green-600 dark:text-green-400">
                                $<span th:text="${#numbers.formatDecimal(totalRevenue, 1, 2)}">0.00</span> MXN
                            </h3>
                        </div>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(renewalsWithAmount)}" class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 text-blue-800 dark:text-blue-300 px-6 py-4 rounded-xl">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-blue-500 text-2xl">info</span>
                        <span>No hay renovaciones con monto registrado</span>
                    </div>
                </div>

                <div th:unless="${#lists.isEmpty(renewalsWithAmount)}">
                    <h6 class="text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-gray-600 dark:text-gray-400">history</span>
                        Historial de Renovaciones
                    </h6>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-900 dark:bg-gray-800 text-white">
                                    <th class="px-4 py-3 text-left text-sm font-semibold rounded-tl-lg">Fecha</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold">Descripci칩n</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold">Meses</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold rounded-tr-lg">Monto</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                                <tr th:each="event : ${renewalsWithAmount}" class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                                    <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-200" th:text="${#temporals.format(event.eventDate, 'dd/MM/yyyy HH:mm')}"></td>
                                    <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300" th:text="${event.description}"></td>
                                    <td class="px-4 py-3 text-sm">
                                        <span th:if="${event.months != null && event.months > 0}" 
                                              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400" 
                                              th:text="'+' + ${event.months} + ' meses'"></span>
                                        <span th:if="${event.months != null && event.months < 0}" 
                                              class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400" 
                                              th:text="${event.months} + ' meses'"></span>
                                        <span th:if="${event.months == null}" class="text-gray-500 dark:text-gray-400 text-xs">N/A</span>
                                    </td>
                                    <td class="px-4 py-3 text-sm font-bold" th:classappend="${event.amount >= 0 ? 'text-green-600 dark:text-green-400' : 'text-red-600 dark:text-red-400'}">
                                        <span th:if="${event.amount >= 0}">+</span>$<span th:text="${#numbers.formatDecimal(event.amount, 1, 2)}">0.00</span> MXN
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Errors -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden mb-6 animate-slide-in">
            <div class="bg-gradient-to-r from-red-500 to-red-600 px-6 py-4">
                <div class="flex items-center gap-3 text-white">
                    <span class="material-symbols-outlined text-2xl">bug_report</span>
                    <h5 class="text-xl font-bold">Errores del Sistema (칔ltimos 7 d칤as)</h5>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                    <div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-xl border border-yellow-200 dark:border-yellow-800">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-2xl text-yellow-600 dark:text-yellow-400">warning</span>
                            <div>
                                <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Errores Sin Resolver</p>
                                <p class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" th:text="${unresolvedErrorCount}">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-red-50 dark:bg-red-900/20 rounded-xl border border-red-200 dark:border-red-800">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-2xl text-red-600 dark:text-red-400">dangerous</span>
                            <div>
                                <p class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-1">Errores Cr칤ticos</p>
                                <p class="text-2xl font-bold text-red-600 dark:text-red-400" th:text="${criticalErrorCount}">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div th:if="${#lists.isEmpty(recentErrors)}" class="bg-green-50 dark:bg-green-900/20 border-l-4 border-green-500 text-green-800 dark:text-green-300 px-6 py-4 rounded-xl">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-green-500 text-2xl">check_circle</span>
                        <span>No hay errores registrados en los 칰ltimos 7 d칤as</span>
                    </div>
                </div>

                <div th:unless="${#lists.isEmpty(recentErrors)}" class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-900 dark:bg-gray-800 text-white">
                                <th class="px-4 py-3 text-left text-sm font-semibold rounded-tl-lg">Fecha</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold">Severidad</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold">Tipo</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold">Mensaje</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold rounded-tr-lg">Estado</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                            <tr th:each="error : ${recentErrors}" class="hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                                <td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-200" th:text="${#temporals.format(error.occurredAt, 'dd/MM HH:mm')}"></td>
                                <td class="px-4 py-3 text-sm">
                                    <span th:text="${error.severityIcon}"></span>
                                    <span class="text-gray-700 dark:text-gray-300" th:text="${error.severityDisplayName}"></span>
                                </td>
                                <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300" th:text="${error.errorType}"></td>
                                <td class="px-4 py-3 text-sm text-gray-700 dark:text-gray-300" th:text="${#strings.abbreviate(error.errorMessage, 50)}"></td>
                                <td class="px-4 py-3 text-sm">
                                    <span th:if="${error.resolved}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">Resuelto</span>
                                    <span th:unless="${error.resolved}" class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400">Pendiente</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- License Events -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden mb-6 animate-slide-in">
            <div class="bg-gradient-to-r from-gray-600 to-gray-700 px-6 py-4">
                <div class="flex items-center gap-3 text-white">
                    <span class="material-symbols-outlined text-2xl">history</span>
                    <h5 class="text-xl font-bold">Historial de la Licencia</h5>
                </div>
            </div>
            <div class="p-6">
                <div th:if="${#lists.isEmpty(licenseEvents)}" class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 text-blue-800 dark:text-blue-300 px-6 py-4 rounded-xl">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-blue-500 text-2xl">info</span>
                        <span>No hay eventos registrados</span>
                    </div>
                </div>

                <div th:unless="${#lists.isEmpty(licenseEvents)}" class="space-y-4">
                    <div th:each="event : ${licenseEvents}" class="border border-gray-200 dark:border-gray-700 rounded-xl p-4 hover:shadow-md transition-shadow bg-gradient-to-r from-gray-50 to-white dark:from-gray-800 dark:to-gray-900">
                        <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-2">
                            <h6 class="text-base font-semibold text-gray-900 dark:text-white" th:text="${event.eventTypeDisplayName}"></h6>
                            <span class="text-xs text-gray-500 dark:text-gray-400" th:text="${#temporals.format(event.eventDate, 'dd/MM/yyyy HH:mm')}"></span>
                        </div>
                        <p class="text-sm text-gray-700 dark:text-gray-300 mb-2" th:text="${event.description}"></p>
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm text-gray-400">person</span>
                            <span class="text-xs text-gray-500 dark:text-gray-400" th:text="'Por: ' + ${event.performedBy}"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes -->
        <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden mb-6 animate-slide-in">
            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 px-6 py-4">
                <div class="flex items-center gap-3 text-white">
                    <span class="material-symbols-outlined text-2xl">sticky_note_2</span>
                    <h5 class="text-xl font-bold">Notas Internas</h5>
                </div>
            </div>
            <div class="p-6">
                <form th:action="@{/programmer/update-notes}" method="post">
                    <textarea class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent dark:bg-gray-800 dark:text-white resize-none" 
                              name="notes" rows="4" 
                              th:text="${license.notes}" 
                              placeholder="Escribe notas sobre este cliente..."></textarea>
                    <button type="submit" class="mt-4 inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary to-primary-dark text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-primary/30 transition-all">
                        <span class="material-symbols-outlined text-lg">save</span>
                        <span>Guardar Notas</span>
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Renew Modal -->
<div class="modal fade" id="renewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-2xl border-0 shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 text-white">
                        <span class="material-symbols-outlined text-2xl">autorenew</span>
                        <h5 class="text-xl font-bold">Renovar Licencia</h5>
                    </div>
                    <button type="button" class="text-white hover:text-gray-200 transition-colors" data-bs-dismiss="modal" aria-label="Close">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>
            <form th:action="@{/programmer/renew}" method="post">
                <div class="modal-body p-6 bg-white dark:bg-gray-900">
                    <!-- Current License Info -->
                    <div class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 px-4 py-3 rounded-lg mb-6">
                        <p class="text-sm font-semibold text-blue-900 dark:text-blue-300 mb-2">Informaci칩n Actual:</p>
                        <div class="space-y-1 text-sm text-blue-800 dark:text-blue-300">
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">calendar_today</span>
                                <span>Vence: <span class="font-semibold" th:text="${#temporals.format(license.expirationDate, 'dd/MM/yyyy')}"></span></span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-base">schedule</span>
                                <span>D칤as restantes: <span class="font-semibold" th:text="${daysLeft}"></span> d칤as</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Meses a Renovar / Restar</label>
                            <select class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="months" id="renewMonths" required>
                                <optgroup label="Restar Tiempo (Cancelaci칩n/Correcci칩n)">
                                    <option value="-12">-12 meses (restar 1 a침o)</option>
                                    <option value="-6">-6 meses</option>
                                    <option value="-3">-3 meses</option>
                                    <option value="-1">-1 mes</option>
                                </optgroup>
                                <optgroup label="Agregar Tiempo (Renovaci칩n)">
                                    <option value="1">+1 mes</option>
                                    <option value="3">+3 meses</option>
                                    <option value="6">+6 meses</option>
                                    <option value="12" selected>+12 meses (1 a침o)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Monto (MXN)</label>
                            <input type="number" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="amount" id="renewAmount" step="0.01" placeholder="0.00">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Positivo = pago recibido, Negativo = reembolso, 0 = sin costo</p>
                        </div>
                    </div>

                    <!-- Preview after renewal -->
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4">
                        <div class="flex items-start gap-3 mb-3">
                            <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-2xl">info</span>
                            <h6 class="text-base font-semibold text-green-900 dark:text-green-300">Despu칠s del cambio:</h6>
                        </div>
                        <div class="space-y-2 ml-8">
                            <div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Nueva fecha de vencimiento:</p>
                                <p id="newExpirationDate" class="text-lg font-bold text-blue-600 dark:text-blue-400"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-1">Total de d칤as de vigencia:</p>
                                <p class="text-lg font-bold text-green-600 dark:text-green-400"><span id="totalDays"></span> d칤as</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer flex items-center justify-end gap-3 px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="px-5 py-2.5 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-green-500/30 transition-all">
                        <span class="material-symbols-outlined text-lg">check</span>
                        <span>Confirmar Renovaci칩n</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Suspend Modal -->
<div class="modal fade" id="suspendModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-2xl border-0 shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-orange-500 to-orange-600 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 text-white">
                        <span class="material-symbols-outlined text-2xl">pause_circle</span>
                        <h5 class="text-xl font-bold">Suspender Licencia</h5>
                    </div>
                    <button type="button" class="text-white hover:text-gray-200 transition-colors" data-bs-dismiss="modal" aria-label="Close">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>
            <form th:action="@{/programmer/suspend}" method="post">
                <div class="modal-body p-6 bg-white dark:bg-gray-900">
                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 px-4 py-3 rounded-lg mb-6">
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-yellow-600 dark:text-yellow-400 text-2xl">warning</span>
                            <p class="text-sm text-yellow-800 dark:text-yellow-300">Esta acci칩n suspender치 el acceso al sistema para el cliente.</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Raz칩n (opcional):</label>
                        <textarea class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-transparent dark:bg-gray-800 dark:text-white resize-none" name="reason" rows="3" placeholder="Motivo de la suspensi칩n..."></textarea>
                    </div>
                </div>
                <div class="modal-footer flex items-center justify-end gap-3 px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="px-5 py-2.5 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-orange-500/30 transition-all">
                        <span class="material-symbols-outlined text-lg">pause_circle</span>
                        <span>Suspender</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Change Package Modal -->
<div class="modal fade" id="changePackageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content rounded-2xl border-0 shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 text-white">
                        <span class="material-symbols-outlined text-2xl">package_2</span>
                        <h5 class="text-xl font-bold">Cambiar Paquete</h5>
                    </div>
                    <button type="button" class="text-white hover:text-gray-200 transition-colors" data-bs-dismiss="modal" aria-label="Close">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>
            <form th:action="@{/programmer/change-package}" method="post">
                <div class="modal-body p-6 bg-white dark:bg-gray-900">
                    <div class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 px-4 py-3 rounded-lg mb-6">
                        <p class="text-sm font-semibold text-blue-900 dark:text-blue-300">Paquete Actual: <span th:text="${license.packageType.displayName}"></span></p>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Nuevo Paquete:</label>
                        <select class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="packageType" id="newPackage" required>
                            <option value="">-- Selecciona un paquete --</option>
                            <option value="BASIC" th:if="${license.packageType.name() != 'BASIC'}">
                                游닍 BASIC - Solo POS ($100/mes)
                            </option>
                            <option value="WEB" th:if="${license.packageType.name() != 'WEB'}">
                                游깷 WEB - Con Landing Page ($150/mes)
                            </option>
                            <option value="ECOMMERCE" th:if="${license.packageType.name() != 'ECOMMERCE'}">
                                游 ECOMMERCE - Con M칩dulo de Clientes ($200/mes)
                            </option>
                        </select>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Puedes cambiar a cualquier paquete disponible</p>
                    </div>

                    <div class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl p-4 hidden" id="packageComparison">
                        <div class="flex items-start gap-3 mb-2">
                            <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-xl">info</span>
                            <h6 class="text-sm font-semibold text-gray-900 dark:text-white">Caracter칤sticas del nuevo paquete:</h6>
                        </div>
                        <ul id="packageFeatures" class="ml-8 text-sm text-gray-700 dark:text-gray-300"></ul>
                    </div>

                    <div class="bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 px-4 py-3 rounded-lg mt-6">
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-yellow-600 dark:text-yellow-400 text-xl">info</span>
                            <p class="text-sm text-yellow-800 dark:text-yellow-300"><span class="font-semibold">Nota:</span> El cambio de paquete es inmediato y afecta las funcionalidades disponibles.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer flex items-center justify-end gap-3 px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="px-5 py-2.5 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-blue-500/30 transition-all">
                        <span class="material-symbols-outlined text-lg">check</span>
                        <span>Cambiar Paquete</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit License Info Modal -->
<div class="modal fade" id="editLicenseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content rounded-2xl border-0 shadow-2xl overflow-hidden">
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3 text-white">
                        <span class="material-symbols-outlined text-2xl">edit</span>
                        <h5 class="text-xl font-bold">Editar Informaci칩n de Licencia</h5>
                    </div>
                    <button type="button" class="text-white hover:text-gray-200 transition-colors" data-bs-dismiss="modal" aria-label="Close">
                        <span class="material-symbols-outlined text-2xl">close</span>
                    </button>
                </div>
            </div>
            <form th:action="@{/programmer/update-info}" method="post">
                <div class="modal-body p-6 bg-white dark:bg-gray-900">
                    <!-- Restaurant Information -->
                    <div class="mb-6">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="material-symbols-outlined text-purple-600 dark:text-purple-400 text-xl">store</span>
                            <h6 class="text-base font-semibold text-purple-600 dark:text-purple-400">Informaci칩n del Restaurante</h6>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Nombre del Restaurante <span class="text-red-500">*</span></label>
                            <input type="text" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="restaurantName" th:value="${license.restaurantName}" required>
                        </div>
                    </div>

                    <!-- Owner Information -->
                    <div class="mb-6">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="material-symbols-outlined text-purple-600 dark:text-purple-400 text-xl">person</span>
                            <h6 class="text-base font-semibold text-purple-600 dark:text-purple-400">Informaci칩n del Propietario</h6>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Nombre Completo <span class="text-red-500">*</span></label>
                                <input type="text" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="ownerName" th:value="${license.ownerName}" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Email <span class="text-red-500">*</span></label>
                                <input type="email" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="ownerEmail" th:value="${license.ownerEmail}" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Tel칠fono <span class="text-red-500">*</span></label>
                                <input type="tel" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="ownerPhone" th:value="${license.ownerPhone}" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">RFC</label>
                                <input type="text" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="ownerRfc" th:value="${license.ownerRfc}" maxlength="13">
                            </div>
                        </div>
                    </div>

                    <!-- System Limits -->
                    <div class="mb-6">
                        <div class="flex items-center gap-2 mb-4">
                            <span class="material-symbols-outlined text-purple-600 dark:text-purple-400 text-xl">tune</span>
                            <h6 class="text-base font-semibold text-purple-600 dark:text-purple-400">L칤mites del Sistema</h6>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">M치ximo de Usuarios <span class="text-red-500">*</span></label>
                                <input type="number" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:text-white" id="editMaxUsers" th:value="${license.maxUsers}" min="1" required>
                                <input type="hidden" id="editMaxUsersHidden" name="maxUsers" th:value="${license.maxUsers}">
                                <div class="flex items-center gap-2 mt-2">
                                    <input class="w-4 h-4 text-purple-600 border-gray-300 rounded focus:ring-purple-500" type="checkbox" id="editUnlimitedUsers" th:checked="${license.maxUsers == null}">
                                    <label class="text-sm text-purple-600 dark:text-purple-400 flex items-center gap-1" for="editUnlimitedUsers">
                                        <span class="material-symbols-outlined text-base">all_inclusive</span>
                                        <span>Sin l칤mite de usuarios</span>
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">N칰mero m치ximo de empleados permitidos</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">M치ximo de Sucursales <span class="text-red-500">*</span></label>
                                <input type="number" class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:text-white" name="maxBranches" th:value="${license.maxBranches}" min="1" required>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">N칰mero m치ximo de sucursales permitidas</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 border-l-4 border-blue-500 px-4 py-3 rounded-lg">
                        <div class="flex items-start gap-3">
                            <span class="material-symbols-outlined text-blue-600 dark:text-blue-400 text-xl">info</span>
                            <p class="text-sm text-blue-800 dark:text-blue-300"><span class="font-semibold">Nota:</span> El tipo de paquete y las fechas no se pueden modificar. Para cambiar el paquete, contacta al soporte t칠cnico.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer flex items-center justify-end gap-3 px-6 py-4 bg-gray-50 dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" class="inline-flex items-center gap-2 px-5 py-2.5 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-xl font-semibold hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors" data-bs-dismiss="modal">
                        <span class="material-symbols-outlined text-lg">close</span>
                        <span>Cancelar</span>
                    </button>
                    <button type="submit" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg hover:shadow-purple-500/30 transition-all">
                        <span class="material-symbols-outlined text-lg">save</span>
                        <span>Guardar Cambios</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create License Modal -->
<div class="modal fade" id="createLicenseModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-plus-circle"></i> Crear Licencia Inicial</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form th:action="@{/programmer/create-license}" method="post" id="createLicenseForm">
                <div class="modal-body">
                    <div class="row">
                        <!-- License Configuration -->
                        <div class="col-md-12">
                            <h6 class="text-primary mb-3"><i class="fas fa-cog"></i> Configuraci칩n de Licencia</h6>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Clave de Licencia <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="licenseKey" 
                                   placeholder="ELGS-2026-REST-1234567890" required>
                            <small class="text-muted">Formato: ELGS-A칌O-C칍DIGO-RANDOM</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tipo de Paquete <span class="text-danger">*</span></label>
                            <select class="form-select" name="packageType" required>
                                <option value="BASIC">B치sico (11 m칩dulos)</option>
                                <option value="WEB">Web (17 m칩dulos)</option>
                                <option value="ECOMMERCE" selected>E-Commerce Completo (28 m칩dulos)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ciclo de Facturaci칩n <span class="text-danger">*</span></label>
                            <select class="form-select" name="billingCycle" required>
                                <option value="MONTHLY" selected>Mensual</option>
                                <option value="ANNUAL">Anual</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Vigencia (meses) <span class="text-danger">*</span></label>
                            <select class="form-select" name="months" required>
                                <option value="1" selected>1 mes</option>
                                <option value="3">3 meses</option>
                                <option value="6">6 meses</option>
                                <option value="12">12 meses (1 a침o)</option>
                            </select>
                        </div>

                        <!-- Restaurant Information -->
                        <div class="col-md-12 mt-3">
                            <h6 class="text-primary mb-3"><i class="fas fa-store"></i> Informaci칩n del Restaurante</h6>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label class="form-label">Nombre del Restaurante <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="restaurantName" 
                                   placeholder="El Gran Saz칩n" required>
                        </div>

                        <!-- Owner Information -->
                        <div class="col-md-12 mt-3">
                            <h6 class="text-primary mb-3"><i class="fas fa-user"></i> Informaci칩n del Propietario</h6>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Nombre Completo <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" name="ownerName" 
                                   placeholder="Juan P칠rez Gonz치lez" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" name="ownerEmail" 
                                   placeholder="propietario@restaurante.com" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tel칠fono <span class="text-danger">*</span></label>
                            <input type="tel" class="form-control" name="ownerPhone" 
                                   placeholder="+52 555-123-4567" required>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">RFC</label>
                            <input type="text" class="form-control" name="ownerRfc" 
                                   placeholder="PEGJ850101XXX" maxlength="13">
                        </div>

                        <!-- System Limits -->
                        <div class="col-md-12 mt-3">
                            <h6 class="text-primary mb-3"><i class="fas fa-sliders-h"></i> L칤mites del Sistema</h6>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">M치ximo de Usuarios</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="createMaxUsers" value="5" min="1">
                                <input type="hidden" id="createMaxUsersHidden" name="maxUsers" value="5">
                            </div>
                            <div class="form-check mt-2">
                                <input class="form-check-input" type="checkbox" id="createUnlimitedUsers">
                                <label class="form-check-label" for="createUnlimitedUsers">
                                    <i class="fas fa-infinity"></i> Sin l칤mite de usuarios
                                </label>
                            </div>
                            <small class="text-muted">N칰mero m치ximo de empleados que pueden usar el sistema</small>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label class="form-label">M치ximo de Sucursales</label>
                            <input type="number" class="form-control" name="maxBranches" value="1" min="1">
                            <small class="text-muted">N칰mero m치ximo de sucursales permitidas</small>
                        </div>
                    </div>

                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle"></i> 
                        <strong>Nota:</strong> Una vez creada la licencia, podr치s renovarla, suspenderla, modificar informaci칩n del cliente y mejorar el paquete cuando sea necesario.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i> Crear Licencia
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    // Handle unlimited users checkbox for create modal
    const createUnlimitedCheckbox = document.getElementById('createUnlimitedUsers');
    const createMaxUsersInput = document.getElementById('createMaxUsers');
    const createMaxUsersHidden = document.getElementById('createMaxUsersHidden');
    
    if (createUnlimitedCheckbox && createMaxUsersInput && createMaxUsersHidden) {
        createUnlimitedCheckbox.addEventListener('change', function() {
            if (this.checked) {
                // Unlimited: disable input and set hidden to empty
                createMaxUsersInput.value = '';
                createMaxUsersInput.disabled = true;
                createMaxUsersInput.removeAttribute('required');
                createMaxUsersHidden.value = ''; // This will be null in backend
            } else {
                // Limited: enable input and sync with hidden
                createMaxUsersInput.disabled = false;
                createMaxUsersInput.value = '5';
                createMaxUsersInput.setAttribute('required', 'required');
                createMaxUsersHidden.value = createMaxUsersInput.value;
            }
        });
        
        // Sync visible input with hidden when user types
        createMaxUsersInput.addEventListener('input', function() {
            if (!createUnlimitedCheckbox.checked) {
                createMaxUsersHidden.value = this.value;
            }
        });
    }

    // Handle unlimited users checkbox for edit modal
    const editUnlimitedCheckbox = document.getElementById('editUnlimitedUsers');
    const editMaxUsersInput = document.getElementById('editMaxUsers');
    const editMaxUsersHidden = document.getElementById('editMaxUsersHidden');
    
    if (editUnlimitedCheckbox && editMaxUsersInput && editMaxUsersHidden) {
        // Initialize state on page load
        if (editUnlimitedCheckbox.checked) {
            editMaxUsersInput.disabled = true;
            editMaxUsersInput.value = '';
            editMaxUsersInput.removeAttribute('required');
            editMaxUsersHidden.value = ''; // Send empty to backend (will be null)
        }
        
        editUnlimitedCheckbox.addEventListener('change', function() {
            if (this.checked) {
                // Unlimited: disable input and set hidden to empty
                editMaxUsersInput.value = '';
                editMaxUsersInput.disabled = true;
                editMaxUsersInput.removeAttribute('required');
                editMaxUsersHidden.value = ''; // This will be null in backend
            } else {
                // Limited: enable input and sync with hidden
                editMaxUsersInput.disabled = false;
                if (!editMaxUsersInput.value) {
                    editMaxUsersInput.value = '5';
                }
                editMaxUsersInput.setAttribute('required', 'required');
                editMaxUsersHidden.value = editMaxUsersInput.value;
            }
        });
        
        // Sync visible input with hidden when user types
        editMaxUsersInput.addEventListener('input', function() {
            if (!editUnlimitedCheckbox.checked) {
                editMaxUsersHidden.value = this.value;
            }
        });
    }

    // Auto-generate license key if needed
    document.getElementById('createLicenseForm')?.addEventListener('submit', function(e) {
        const licenseKeyInput = document.querySelector('input[name="licenseKey"]');
        if (!licenseKeyInput.value || licenseKeyInput.value.trim() === '') {
            const year = new Date().getFullYear();
            const restaurantName = document.querySelector('input[name="restaurantName"]').value;
            const code = restaurantName.replace(/[^A-Za-z]/g, '').toUpperCase().substring(0, 4);
            const random = Date.now().toString().substring(7);
            licenseKeyInput.value = `ELGS-${year}-${code}-${random}`;
        }
    });

    // Calculate new expiration date when renewing
    /*[+
    const currentExpiration = new Date([[${license.expirationDate}]]);
    +]*/
    
    function calculateRenewal() {
        const months = parseInt(document.getElementById('renewMonths').value);
        
        // Calculate new expiration date
        const newDate = new Date(currentExpiration);
        newDate.setMonth(newDate.getMonth() + months);
        
        // Format date as DD/MM/YYYY
        const day = String(newDate.getDate()).padStart(2, '0');
        const month = String(newDate.getMonth() + 1).padStart(2, '0');
        const year = newDate.getFullYear();
        const formattedDate = `${day}/${month}/${year}`;
        
        // Calculate total days from today
        const today = new Date();
        const diffTime = newDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        // Update display
        document.getElementById('newExpirationDate').textContent = formattedDate;
        document.getElementById('totalDays').textContent = diffDays;
    }
    
    // Update calculations when modal opens or dropdown changes
    document.getElementById('renewModal')?.addEventListener('shown.bs.modal', calculateRenewal);
    document.getElementById('renewMonths')?.addEventListener('change', calculateRenewal);

    // Show package features when selecting new package
    document.getElementById('newPackage')?.addEventListener('change', function() {
        const selectedPackage = this.value;
        const comparisonCard = document.getElementById('packageComparison');
        const featuresList = document.getElementById('packageFeatures');
        
        if (selectedPackage) {
            const features = {
                'BASIC': [
                    'Sistema POS completo',
                    'Gesti칩n de ingredientes e inventario',
                    'Sistema de reservas',
                    'Sistema de 칩rdenes',
                    'Reportes y estad칤sticas',
                    '仇 Sin Landing Page',
                    '仇 Sin m칩dulo de clientes'
                ],
                'WEB': [
                    'Sistema POS completo',
                    'Landing Page para mostrar men칰 online',
                    'Gesti칩n de ingredientes e inventario',
                    'Sistema de reservas',
                    'Sistema de 칩rdenes',
                    'Reportes y estad칤sticas',
                    '仇 Sin m칩dulo de clientes'
                ],
                'ECOMMERCE': [
                    'Todo lo del paquete WEB +',
                    'M칩dulo de clientes con registro',
                    'Clientes pueden hacer pedidos online',
                    'Sistema de rese침as y calificaciones',
                    'Carrito de compras',
                    'Seguimiento de pedidos para clientes'
                ]
            };
            
            featuresList.innerHTML = features[selectedPackage]
                .map(f => `<li>${f}</li>`)
                .join('');
            comparisonCard.style.display = 'block';
        } else {
            comparisonCard.style.display = 'none';
        }
    });
</script>
</body>
</html>
